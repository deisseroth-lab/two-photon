<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Generator content="Microsoft Word 14 (filtered)">
<title>Function Syntax Help</title>
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Cambria;
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
h1
	{mso-style-link:"Heading 1 Char";
	margin-right:0in;
	margin-left:0in;
	font-size:24.0pt;
	font-family:"Times New Roman","serif";
	font-weight:bold;}
h2
	{mso-style-link:"Heading 2 Char";
	margin-top:10.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	page-break-after:avoid;
	font-size:13.0pt;
	font-family:"Cambria","serif";
	color:#4F81BD;
	font-weight:bold;}
h3
	{mso-style-link:"Heading 3 Char";
	margin-right:0in;
	margin-left:0in;
	font-size:13.5pt;
	font-family:"Times New Roman","serif";
	font-weight:bold;}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{mso-style-link:"Footer Char";
	margin-right:0in;
	margin-left:0in;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;}
p.MsoDocumentMap, li.MsoDocumentMap, div.MsoDocumentMap
	{mso-style-link:"Document Map Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:8.0pt;
	font-family:"Tahoma","sans-serif";}
p
	{margin-right:0in;
	margin-left:0in;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
span.Heading1Char
	{mso-style-name:"Heading 1 Char";
	mso-style-link:"Heading 1";
	font-family:"Cambria","serif";
	color:#365F91;
	font-weight:bold;}
span.Heading2Char
	{mso-style-name:"Heading 2 Char";
	mso-style-link:"Heading 2";
	font-family:"Cambria","serif";
	color:#4F81BD;
	font-weight:bold;}
span.Heading3Char
	{mso-style-name:"Heading 3 Char";
	mso-style-link:"Heading 3";
	font-family:"Cambria","serif";
	color:#4F81BD;
	font-weight:bold;}
span.FooterChar
	{mso-style-name:"Footer Char";
	mso-style-link:Footer;
	font-family:"Times New Roman","serif";}
span.DocumentMapChar
	{mso-style-name:"Document Map Char";
	mso-style-link:"Document Map";
	font-family:"Tahoma","sans-serif";}
p.msochpdefault, li.msochpdefault, div.msochpdefault
	{mso-style-name:msochpdefault;
	margin-right:0in;
	margin-left:0in;
	font-size:10.0pt;
	font-family:"Times New Roman","serif";}
.MsoChpDefault
	{font-size:10.0pt;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
-->
</style>

</head>

<body bgcolor=lightyellow lang=EN-US link=blue vlink=purple>

<div class=WordSection1>

<h2><span style='font-size:16.0pt'>PrairieLink Description</span></h2>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>PrairieLink
is an API (Application Programming Interface) which allows direct two-way
communication with Prairie View without understanding the underlying
communication protocols.&nbsp; Put simply, it uses script commands to
communicate with Prairie View via TCP/IP.&nbsp; For more information please
reference the script command documentation accessible from the script editor
under the </span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>Tools menu
in Prairie View, or use <a href="../Documentation/commandLineHelp.html"><span
style='font-family:"Times New Roman","serif";color:windowtext;text-decoration:
none'>this link</span></a>.</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<h2><span style='font-size:16.0pt'>Using PrairieLink</span></h2>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>Using
PrairieLink will differ based on what language you are using, for example VB
.NET or MATLAB.&nbsp; To use PrairieLink in a .NET language first add
PrairieLink.dll as a reference then instantiate a new object of type
PrairieLink.Application, for example:</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><b><span style='font-family:"Calibri","sans-serif"'>Dim pl
As New PrairieLink.Application</span></b></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>To use
PrairieLink in MATLAB the equivalent line would be:</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><b><span style='font-family:"Calibri","sans-serif"'>pl =
actxserver('PrairieLink.Application');</span></b></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>Once a
PrairieLink object has been instantiated you must connect to Prairie View using
the Connect function:</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><b><span style='font-family:"Calibri","sans-serif"'>pl.Connect()</span></b></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>Optionally
include the IP address parameter to connect to Prairie View running on another
computer:</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><b><span style='font-family:"Calibri","sans-serif"'>pl.Connect(“127.0.0.1”)</span></b></p>

<p class=MsoNormal><b><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></b></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>The Connect
function will return a Boolean value: true if the connection succeeded or false
if the connection failed.</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>Once
connected any of the methods described below can be used, without an active
connection to Prairie View they not work.</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>For
example, the following will return the current dwell time in microseconds:</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><b><span style='font-family:"Calibri","sans-serif"'>pl.GetState(“dwellTime”)</span></b></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>When
finished, use the Disconnect method to let Prairie View know so it can clean up
afterwards; failure to disconnect properly could result in undesirable
behavior.</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><b><span style='font-family:"Calibri","sans-serif"'>pl.Disconnect()</span></b></p>

<p class=MsoNormal><b><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></b></p>

<h2><a name=methods></a><span style='font-size:16.0pt'>PrairieLink Methods</span></h2>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal><b><span style='font-size:14.0pt;font-family:"Calibri","sans-serif"'>Connect</span></b><span
style='font-size:14.0pt;font-family:"Calibri","sans-serif"'>(<i><span
style='color:#7F7F7F'>optional</span></i> IPAddress as String) as Boolean</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>This
function connects to the currently running instance of Prairie View at the
address provided and returns true if the connection was successful or false if
the connection failed.&nbsp; If the optional IP address is not provided
PrairieLink will connect to the currently running instance of Prairie View on
the same machine.&nbsp; Note that some methods only work on the same machine,
those exceptions will be mentioned in the descriptions of any affected methods.</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><b><span style='font-size:14.0pt;font-family:"Calibri","sans-serif"'>Connected</span></b><span
style='font-size:14.0pt;font-family:"Calibri","sans-serif"'>() as Boolean</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>This
function returns true if a connection has been made or false if no connection
is present.</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><b><span style='font-size:14.0pt;font-family:"Calibri","sans-serif"'>Disconnect</span></b><span
style='font-size:14.0pt;font-family:"Calibri","sans-serif"'>()</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>This method
disconnects from Prairie View.&nbsp; Prairie View needs to do a little bit of
cleanup when a communication channel isn’t being used anymore, so failure to
disconnect, particularly after numerous connections are made in the same
session, could result in undesirable behavior.</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><b><span style='font-size:14.0pt;font-family:"Calibri","sans-serif"'>SendScriptCommands</span></b><span
style='font-size:14.0pt;font-family:"Calibri","sans-serif"'>(commands as
String) as Boolean.<br>
</span><span style='font-family:"Calibri","sans-serif"'>This function sends a
string of script commands to Prairie View which will then be run.&nbsp; If the
script commands run successfully the function will return true, otherwise it
will return false.&nbsp; For a complete listing of available script commands
please reference the script command documentation accessible from the script
editor under the Tools menu in Prairie View, or use <a
href="../Documentation/commandLineHelp.html">this link</a>.&nbsp; Some script
commands can return values; each time a script command returns a value an event
will be raised for which a handler can be registered to do something with the
value.&nbsp; There are also specific functions to call a single script command
which returns a value without using events.&nbsp; See the <a
href="#eventHandling">event handling</a> section below for more details.</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><b><span style='font-size:14.0pt;font-family:"Calibri","sans-serif"'>PixelsPerLine</span></b><span
style='font-size:14.0pt;font-family:"Calibri","sans-serif"'>() as Integer</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>This
function returns the number of image pixels in the width/X dimension as an
integer.</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><b><span style='font-size:14.0pt;font-family:"Calibri","sans-serif"'>LinesPerFrame</span></b><span
style='font-size:14.0pt;font-family:"Calibri","sans-serif"'>() as Integer</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>This
function returns the number of image pixels in the height/Y dimension as an integer.</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><b><span style='font-size:14.0pt;font-family:"Calibri","sans-serif"'>GetState</span></b><span
style='font-size:14.0pt;font-family:"Calibri","sans-serif"'>(key as String, <i><span
style='color:#7F7F7F'>optional</span></i> index as String,<i><span
style='color:#7F7F7F'> optional</span></i> subindex as String) as String</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>This
function returns the value for the specified state key as a string.&nbsp; Some
state keys are indexed or subindexed which requires the optional parameters to
be used.&nbsp; Use the PVStateShard section of the environment file as a
reference.</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><b><span style='font-size:14.0pt;font-family:"Calibri","sans-serif"'>GetMotorPosition</span></b><span
style='font-size:14.0pt;font-family:"Calibri","sans-serif"'>(axis as String
(‘X’, ‘Y’ or ‘Z’), <i><span style='color:#7F7F7F'>optional</span></i>
deviceIndex as Integer) as Double</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>This
function returns the position of the specified axis as a double precision floating
point value.&nbsp; On some systems there are multiple devices for an axis so
the optional device index parameter can be used to differentiate between
them.&nbsp; The device index parameter is zero index, so the first device is
zero.</span></p>

<p class=MsoNormal><b><span style='font-size:14.0pt;font-family:"Calibri","sans-serif"'>&nbsp;</span></b></p>

<p class=MsoNormal><b><span style='font-size:14.0pt;font-family:"Calibri","sans-serif"'>GetImage</span></b><span
style='font-size:14.0pt;font-family:"Calibri","sans-serif"'>(channel as Integer)
as Integer(,)</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>This
function returns a two dimensional array containing the image data for the
specified channel.&nbsp; In cases where there are multiple samples for a pixel
the values are summed, not averaged.&nbsp; Note that this function will only
work on the same computer that Prairie View is running on, it will return an
array of zero’s if run on a different computer.</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><b><span style='font-size:14.0pt;font-family:"Calibri","sans-serif"'>GetImage_2</span></b><span
style='font-size:14.0pt;font-family:"Calibri","sans-serif"'>(channel as
Integer, pixelsPerLine as Integer, linesPerFrame as Integer) as Integer(,)</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>This
function is a slightly more efficient version of the GetImage function to be
used in cases where the image dimensions are known.&nbsp; This eliminates the
need to poll Prairie View for the image dimensions, saving a little time.&nbsp;
Note that this function will only work on the same computer that Prairie View
is running on, it will return an array of zero’s if run on a different
computer.</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><b><span style='font-size:14.0pt;font-family:"Calibri","sans-serif"'>DroppedData</span></b><span
style='font-size:14.0pt;font-family:"Calibri","sans-serif"'>() as Boolean</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>This
function returns true if the current acquisition has dropped data or false if
all the data has been saved successfully.</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><b><span style='font-size:14.0pt;font-family:"Calibri","sans-serif"'>ReadRawDataStream</span></b><span
style='font-size:14.0pt;font-family:"Calibri","sans-serif"'>(<i><span
style='color:#7F7F7F'>out</span></i> samplesRead as Integer) as Short()</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>In order to
use this function raw data streaming needs to be enabled by calling the script
command ‘–srd true’, otherwise this function will never return any samples. 
This function will return an array of samples as they are read off of the
acquisition card.  This function will guarantee that the chunks of data
returned will form contiguous whole frames.  If frames of data are not read off
fast enough, only the most recent frames will be kept and the stream will omit
the frame(s) in between.  Making sense of the data stream requires knowledge of
the acquisition being run, like how many pixels are in a line, how many lines
are in a frame, how many samples are acquired for each pixel, and how many
channels of data are being acquired.  All of these things can be polled for
using script commands.  For example a galvo mode acquisition for two channels
at a 4us dwell time will have two 16-bit values for each sample (one for each
channel) and 10 samples for each pixel (4/.4).  The SamplesPerPixel function
can help figure this out for other acquisition modes.  Multiple channels for a
camera based acquisition will not be interleaved.  Using this function will
definitely require some trial and error as every application will be different.</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><b><span style='font-size:14.0pt;font-family:"Calibri","sans-serif"'>SamplesPerPixel</span></b><span
style='font-size:14.0pt;font-family:"Calibri","sans-serif"'>() as Integer</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>This
function returns how many samples are acquired for each pixel in the image. 
This is mainly useful when used in conjunction with the ReadRawDataStream
function to figure out how to parse the raw data stream.</span></p>

<p class=MsoNormal>&nbsp;</p>

<h2><a name=eventHandling></a><span style='font-size:16.0pt'>PrairieLink Event
Handling</span></h2>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>There is
currently only one event raise by PrairieLink which is used to handle script
command responses asynchronously.&nbsp; There are specific methods to call a
single script command and return the response synchronously in the <a
href="#methods">methods</a> section above.&nbsp; The following code will
register for script command response events in VB .NET:</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><b><span style='font-family:"Calibri","sans-serif"'>AddHandler
pl.ScriptCommandResponse, AddressOf ScriptCommandResponseHandler</span></b></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>Where the
handler subroutine looks something like:</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><b><span style='font-family:"Calibri","sans-serif"'>Private
Sub ScriptCommandResponseHandler(ByVal response As String)</span></b></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>…</span></p>

<p class=MsoNormal><b><span style='font-family:"Calibri","sans-serif"'>End Sub</span></b></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>To register
for the same event in MATLAB the code would look like this:</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal><b><span style='font-family:"Calibri","sans-serif"'>pl.registerevent({'ScriptCommandResponse'
'ScriptCommandResponseHandler'});</span></b></p>

<p class=MsoNormal><b><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></b></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>Where the
handler subroutine would be in an M file with the same name, in the current
working directory, and look something like:</span></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>&nbsp;</span></p>

<p class=MsoNormal style='text-autospace:none'><b><span style='font-family:
"Calibri","sans-serif"'>function HandleScriptCommandRequest(source, eventId,
response, args, type)</span></b></p>

<p class=MsoNormal style='text-autospace:none'><span style='font-family:"Calibri","sans-serif"'>…</span></p>

<p class=MsoNormal style='text-autospace:none'><b><span style='font-family:
"Calibri","sans-serif"'>end</span></b></p>

<p class=MsoNormal style='text-autospace:none'><b><span style='font-family:
"Calibri","sans-serif"'>&nbsp;</span></b></p>

<p class=MsoNormal><span style='font-family:"Calibri","sans-serif"'>The response
parameter in both cases contains Prairie View’s response as a string.</span></p>

</div>

</body>

</html>
